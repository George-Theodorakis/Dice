 <!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Probability Simulation</title>
</head>
<body>
<div class="outerContainer">
<div>
<h1>This is a simulator for a game of chance</h1>
<p>Two players each have a probability model based on rolling dice and performing operations on the results.</p>
<p>The probability that each player wins is shown in the text boxes below.</p>
<h2>How to Use</h2>
<p>There are two ways to define individual dice:  Merely typing a number such as <span class="input">6</span> represents a 6 sided die, while listing the number on each side in brackets can also represent a die.  For example, <span class="input">{1,2,3,4,5,6}</span> is functionally identical to <span class="input">6</span>, although other combinations can be made.  Dice do not have a certain number of sides, but the number on each side must be an integer.</p>
<p>Operations on dice are represented by putting the dice in a type of brackets: <span class="input">()</span> are used for addition, <span class="input"><></span> are used for multiplication, and <span class="input">[]</span> are used for finding the maximum on any given die.  For example, <span class="input">[6,6]</span> means rolling 2 six sided dice and taking the higher value between them.  These operations can be combined - <span class="input"><[6,6],[6,6],6></span> is perfectly valid.</p>
<p>Additionally, colons can be used to represent multiple copies - instead of writing <span class="input">[6,6]</span>, <span class="input">[6:2]</span> can be used. <span class="input"><[6,6],[6,6],6></span> is the same as <span class="input"><[6:2]:2,6></span>.</p>
<p>Warning: Setting the number of trials or combinations of dice too high may cause your browser to freeze - be wary when increasing the trial number or total number of dice simulated.  The approximate number of simulations per second is provided for the given settings after each run, but these may be inaccurate with small amounts of trials.  Note that with a large amount of dice, the time taken to calculate the probability may be large.  This should be addressed in a future version.</p>

</div>
<div>

	Dice to simulate<input type="text" id="input" size=99></input><br>
	Trials to run<input type="text" id="trials"></input>
	<p><Button type="button" id="button" onclick="analyze()">Go!</Button></p>
	<div class="graphTemplate" id="graphTemplate">
		<div class="graph">
			<canvas id="canvas%" class="graph" width=600 height=300></canvas>
			<div><input type="checkbox" id="norm%" checked onclick="drawCanvases()"></input>Normalize graph<input type="checkbox" id="normal%" onclick="drawCanvases()"></input> Display bell curve<input type="checkbox" id="box%" onclick="drawCanvases()"></input>Display box plot</div>
			<div>Experimental Probability of winning<input type="text" id="exOut%" disabled></input></div>
			<div>Theoretical Probability of winning<input type="text"  id="theoOut%" disabled></input></div>
			<div>Theoretical Probability of winning<input type="text" id="theoFOut%" disabled></input></div>
		</div>
	</div>
	<div class="graphContainer" id="graphContainer">
	</div>
</div>

</div>
<link rel="stylesheet" type="text/css" href="css/style.css">
<script src = "js/ProbabilityModel.js"></script>
<script src = "js/Die.js"></script>
<script src = "js/SimpleDie.js"></script>
<script src = "js/ComplexDie.js"></script>
<script src = "js/MultiDie.js"></script>
<script src = "js/Main.js"></script>
<script src = "js/Fraction.js"></script>
<script src = "js/CanvasDrawing.js"></script>
<script>
var dice = [];

	var updateDice = function(){//this function does too much, it also updates DOM
		var input = document.getElementById("input");
		dice = parse(input.value).map(createDie);
		var graphContainer = document.getElementById("graphContainer");
		graphContainer.innerHTML = "";
		var graphTemplate = document.getElementById("graphTemplate");
		var graphHtml = graphTemplate.innerHTML;
		for(var i = 0; i < dice.length; i++){
			graphContainer.innerHTML = graphContainer.innerHTML + graphHtml.replace(/\%/g,i);
		}
	}
	var calculateProb = function(firstDie,secondDice){
		if(secondDice.length==0)return 1;
		return 1-new SubtractDie([firstDie,new MaxDie(secondDice)]).cdf(0);
	}
	var calculateProbFrac = function(firstDie,secondDice){
		if(secondDice.length==0)return new Fraction(1,1);
		return new Fraction(1,1).subtract(new SubtractDie([firstDie,new MaxDie(secondDice)]).cdfFrac(0));
	}
	
	var runSimulation = function(dice,trials){
		var wins=[];
		for(var i = 0; i  < dice.length; i++){
			wins[i]=0;
		}
		
		for (var i = 0; i < trials; i++)
		{
			var max=dice[0].roll();
			var maxIndex=0;
			var tie=false;
			for(var j = 1; j < dice.length; j++){
				var roll = dice[j].roll();
				if(roll>max){
					max=roll;
					maxIndex=j;
					tie=false;
				}else if(roll==max){
					tie=true;
				}
			}
			if(!tie){
				wins[maxIndex]++;
			}
		}
		for(var i = 0; i < dice.length; i++){
			wins[i]=wins[i]/trials;
		}
		return wins;
		
	
	}
	var analyze = function(){
	
		var trials = document.getElementById("trials").value;
	  	var result = {};
	  	updateDice();
	  	drawCanvases();
 	 	var start = new Date().getTime();			
 	  	result.simulation=runSimulation(dice,trials);
	  	var end = new Date().getTime();
		result.prob=[];
		result.probFrac=[];
		for(var i = 0; i < dice.length; i++){
			result.prob.push(calculateProb(dice[i],dice.filter(function(val,index){return index!=i;})));
		}
		try{
			for(var i = 0; i < dice.length; i++){
				result.probFrac.push(calculateProbFrac(dice[i],dice.filter(function(val,index){return index!=i;})));
			}
		}catch(e){
			for(var i = 0; i < dice.length; i++){
				result.probFrac.push("Cannot calculate exact");
			}
		}
		for(var i = 0; i < dice.length; i++){
			document.getElementById("exOut"+i).value = result.simulation[i];
			document.getElementById("theoOut"+i).value = result.prob[i];
			document.getElementById("theoFOut"+i).value = result.probFrac[i];
		}
		//delete mr!
		/*try{
			result.probFrac1=calculateProbFrac(dice[0],[dice[1]]);
			result.probFrac2=calculateProbFrac(dice[1],[dice[0]]);
		}catch(err){
			console.log(err);
			result.probFrac1 = "Cannot calculate exact";
			result.probFrac2 = "Cannot calculate exact";
		}
		result.prob1=calculateProb(dice[0],[dice[1]]);
		result.prob2=calculateProb(dice[1],[dice[0]]);
		document.getElementById("exOut1").value=result.simulation[0];	
		document.getElementById("theoOut1").value=result.prob1;
		document.getElementById("theoFOut1").value=result.probFrac1;
		document.getElementById("exOut2").value=result.simulation[1];
		document.getElementById("theoOut2").value=result.prob2;
		document.getElementById("theoFOut2").value=result.probFrac2;*/
	}
	var drawCanvases = function(){
		var probs = dice.map(function(die){return die.probModel;});
		var flags = [];
		for(var i = 0; i < dice.length; i++){
			flags.push({histogram:true, box:document.getElementById("box"+i).checked,normal:document.getElementById("normal"+i).checked,normalize:document.getElementById("norm"+i).checked});
		}
		var normProbs = [];
		for(var i = 0; i < dice.length; i++){
			if(flags[i].normalize){
				normProbs.push(probs[i]);
			}
		}
		var normWindow = calculateWindow(normProbs);
		for(var i = 0; i < dice.length; i++){
			if(flags[i].normalize){
				drawCanvas(document.getElementById("canvas" + i),probs[i],normWindow,flags[i]);
			}else{
				drawCanvas(document.getElementById("canvas" + i),probs[i],calculateWindow([probs[i]]),flags[i]);
			}
		}
	}
	

</script>
</body>
</html>
