 <!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Probability Simulation</title>
</head>
<body>

<div>
<h1>This is a simulator for a game of chance</h1>
<p>Two players each have a probability model based on rolling dice and performing operations on the results.</p>
<p>The probability that each player wins is shown in the text boxes below.</p>
<h2>How to Use</h2>
<p>There are two ways to define individual dice:  Merely typing a number such as <span class="input">6</span> represents a 6 sided die, while listing the number on each side in brackets can also represent a die.  For example, <span class="input">{1,2,3,4,5,6}</span> is functionally identical to <span class="input">6</span>, although other combinations can be made.  Dice do not have a certain number of sides, but the number on each side must be an integer.</p>
<p>Operations on dice are represented by putting the dice in a type of brackets: <span class="input">()</span> are used for addition, <span class="input"><></span> are used for multiplication, and <span class="input">[]</span> are used for finding the maximum on any given die.  For example, <span class="input">[6,6]</span> means rolling 2 six sided dice and taking the higher value between them.  These operations can be combined - <span class="input"><[6,6],[6,6],6></span> is perfectly valid.</p>
<p>Additionally, colons can be used to represent multiple copies - instead of writing <span class="input">[6,6]</span>, <span class="input">[6:2]</span> can be used. <span class="input"><[6,6],[6,6],6></span> is the same as <span class="input"><[6:2]:2,6></span>.</p>
<p>Warning: Setting the number of trials or combinations of dice too high may cause your browser to freeze - be wary when increasing the trial number or total number of dice simulated.  The approximate number of simulations per second is provided for the given settings after each run, but these may be inaccurate with small amounts of trials.  Note that with a large amount of dice, the time taken to calculate the probability may be large.  This should be addressed in a future version.</p>
</div>

<div>

 <div class="graphContainer">
  <div class="graph">
   <canvas id="canvas1" width=400px height=200px ></canvas>
  </div>
  <div class="graph">
   <canvas id="canvas2" width=400px height=200px ></canvas>
  </div>
 </div>
 
<p>Player 1 Dice <Input id="firstIn" value=6> <Button type="button" onclick="showDice(0)">Show Dice</Button> <Button type="button" onclick="rollDice(0)">Roll Dice</Button></p>
<p>Player 2 Dice <Input id="secondIn" value=6> <Button type="button" onclick="showDice(1)">Show Dice</Button> <Button type="button" onclick="rollDice(1)">Roll Dice</Button></p>
<p>Number of trials <Input id="trials" value=10000></p>
<p>Experimental Probability that Player 1 wins<Input id="experimentalOut1" disabled=true></p>
<p>Experimental Probability that Player 2 wins<Input id="experimentalOut2" disabled=true></p>
<p>Theoretical Probability that Player 1 wins<Input id="theoreticalOut1" disabled=true>   <Input id="theoreticalOutFrac1" disabled=true size=27></p>
<p>Theoretical Probability that Player 2 wins<Input id="theoreticalOut2" disabled=true>   <Input id="theoreticalOutFrac2" disabled=true size=27></p>
<p>Simulations per second <Input id="simulPerSecond" disabled=true></p>
<p><Button type="button" id="button">Go!</Button></p>
</div>


<link rel="stylesheet" type="text/css" href="css/style.css">
<script src = "js/ProbabilityModel.js"></script>
<script src = "js/Die.js"></script>
<script src = "js/SimpleDie.js"></script>
<script src = "js/ComplexDie.js"></script>
<script src = "js/MultiDie.js"></script>
<script src = "js/Main.js"></script>
<script src = "js/Fraction.js"></script>
<script src = "js/CanvasDrawing.js"></script>
<script>

	var calculateProb = function(firstDice,secondDice){
		
	 	var firstMaxSides=0;
		var prob = 0;
	 	for(var i=0; i < firstDice.length; i++){
	 	 	firstMaxSides=Math.max(firstMaxSides,firstDice[i].maxValue());
	 	}
		for (var i = 2; i <= firstMaxSides; i++)
		{
			prob+=pdf(i, firstDice)*cdf(i - 1, secondDice);
		}
		return prob;
	}
	var calculateProbFrac = function(firstDice,secondDice){
		var prob = new Fraction(0,1);
	  	var firstMaxSides=0;
		for(var i=0; i < firstDice.length; i++){
	 	 	firstMaxSides=Math.max(firstMaxSides,firstDice[i].maxValue());
	 	}
		for (var i = 2; i <= firstMaxSides; i++)
		{
			prob = prob.add(pdfFrac(i, firstDice).multiply(cdfFrac(i - 1, secondDice))).simplify();
		}
		return prob;
	
	}
	var pdf = function(value,dice){
		return cdf(value,dice)-cdf(value-1,dice);
	}
	var cdf = function(value,dice){
		var result=1;
		dice.forEach(function(die){
			result*=die.cdf(value);
		});
		return result;
	}
	var pdfFrac = function(value,dice){
		return cdfFrac(value,dice).subtract(cdfFrac(value-1,dice));
	}
	var cdfFrac = function(value,dice){
		var result=new Fraction(1,1);
		dice.forEach(function(die){
			result=result.multiply(die.cdfFrac(value));
		});
		return result;
	}
	window.onload = function(){
		document.getElementById("button").onclick = function(){
			var trials = document.getElementById("trials").value;
	 	 	var result = {};
	 	 	updateDice();
	 	 	drawCanvases();
 	 		var start = new Date().getTime();			
 	 	 	result.simulation=runSimulation([dice[0]],[dice[1]],trials);
	 	 	var end = new Date().getTime();
			try{
				result.probFrac1=calculateProbFrac([dice[0]],[dice[1]]);
				result.probFrac2=calculateProbFrac([dice[1]],[dice[0]]);
			}catch(err){
				console.log(err);
				result.probFrac1 = "Cannot calculate exact";
				result.probFrac2 = "Cannot calculate exact";
			}
			result.prob1=calculateProb([dice[0]],[dice[1]]);
			result.prob2=calculateProb([dice[1]],[dice[0]]);
	
			document.getElementById("simulPerSecond").value=(trials*1000/(end-start));
			document.getElementById("experimentalOut1").value=result.simulation[0];	
			document.getElementById("experimentalOut2").value=result.simulation[1];
			document.getElementById("theoreticalOut1").value=result.prob1;
			document.getElementById("theoreticalOutFrac1").value=result.probFrac1;
			document.getElementById("theoreticalOut2").value=result.prob2;
			document.getElementById("theoreticalOutFrac2").value=result.probFrac2;
		}
	}
</script>
</body>
</html>
